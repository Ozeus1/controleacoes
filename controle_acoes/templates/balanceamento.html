{% extends 'base.html' %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<style>
    /* Force Dark Theme Override */
    body {
        background-color: var(--bg-color) !important;
        color: var(--text-primary) !important;
    }

    .card {
        background-color: var(--card-bg) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
    }

    .modal-content {
        background-color: var(--card-bg);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .modal-header,
    .modal-footer {
        border-color: var(--border-color);
    }

    .form-control,
    .form-select {
        background-color: #334155;
        /* Slate 700 */
        color: #fff;
        border-color: #475569;
    }

    .form-control:focus,
    .form-select:focus {
        background-color: #334155;
        color: #fff;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.25);
    }

    /* Fix table transparency */
    .table {
        color: var(--text-primary) !important;
    }

    .table-center-forced th,
    .table-center-forced td {
        text-align: center !important;
        vertical-align: middle !important;
    }
</style>

<div class="row mb-4">
    <div class="col-12">
        <h2 class="text-white"><i class="fas fa-balance-scale"></i> Balanceamento de Carteira</h2>
    </div>
</div>

<!-- Add Buttons Row -->
<div class="row mb-4">
    <div class="col-12">
        <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#modalRFC"><i
                class="fas fa-plus"></i> Renda Fixa P√≥s</button>
        <button class="btn btn-warning me-2" data-bs-toggle="modal" data-bs-target="#modalRFP"><i
                class="fas fa-plus"></i> Renda Fixa Pr√©</button>
        <button class="btn btn-danger me-2" data-bs-toggle="modal" data-bs-target="#modalRFI"><i
                class="fas fa-plus"></i> Renda Fixa IPCA</button>
        <button class="btn btn-info me-2" data-bs-toggle="modal" data-bs-target="#modalFund"><i class="fas fa-plus"></i>
            Fundos</button>
        <button class="btn btn-dark me-2" data-bs-toggle="modal" data-bs-target="#modalCrypto"><i
                class="fas fa-coins"></i> Cripto</button>
        <button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#modalPension"><i
                class="fas fa-piggy-bank"></i> Previd√™ncia</button>
        <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#modalIntl"><i
                class="fas fa-globe"></i> Internacional</button>
        <a href="{{ url_for('update_intl_quotes') }}" class="btn btn-outline-light ms-2"
            title="Atualizar Cota√ß√µes Internacionais">
            <i class="fas fa-sync-alt"></i> Atualizar Int.
        </a>
    </div>
</div>

<!-- RENDA FIXA TABLES -->
<div class="row">
    <!-- POS FIXADA -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-primary">
            <div
                class="card-header bg-primary text-white font-weight-bold d-flex justify-content-between align-items-center">
                <span>Renda Fixa P√≥s-Fixada</span>
                <button class="btn btn-sm btn-light text-primary" data-bs-toggle="modal" data-bs-target="#modalRFC">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0 table-center-forced align-middle">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Banco</th>
                            <th>Fundo/Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Taxa</th>
                            <th>Vencimento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in rf_pos %}
                        <tr>
                            <td>{{ item.product_type or '-' }}</td>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td>{{ item.rate }}</td>
                            <td>{{ item.maturity_date.strftime('%d/%m/%Y') if item.maturity_date else '-' }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    </tbody>
                    <tfoot>
                        <tr class="font-weight-bold" style="background-color: rgba(255,255,255,0.05);">
                            <td colspan="3" class="text-right">TOTAL</td>
                            <td>R$ {{ types_total['Renda Fixa P√≥s'] | brl_fmt }}</td>
                            <td colspan="3">-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- PRE FIXADA -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-warning">
            <div
                class="card-header bg-warning text-dark font-weight-bold d-flex justify-content-between align-items-center">
                <span>Renda Fixa Pr√©-Fixada</span>
                <button class="btn btn-sm btn-dark text-warning" data-bs-toggle="modal" data-bs-target="#modalRFP">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0 table-center-forced align-middle">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Banco</th>
                            <th>Fundo/Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Taxa</th>
                            <th>Vencimento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in rf_pre %}
                        <tr>
                            <td>{{ item.product_type }}</td>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td>{{ item.rate }}</td>
                            <td>{{ item.maturity_date.strftime('%d/%m/%Y') if item.maturity_date else '-' }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    </tbody>
                    <tfoot>
                        <tr class="font-weight-bold" style="background-color: rgba(255,255,255,0.05);">
                            <td colspan="3" class="text-right">TOTAL</td>
                            <td>R$ {{ types_total['Renda Fixa Pr√©'] | brl_fmt }}</td>
                            <td colspan="3">-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- IPCA -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-danger">
            <div
                class="card-header bg-danger text-white font-weight-bold d-flex justify-content-between align-items-center">
                <span>Renda Fixa Infla√ß√£o (IPCA)</span>
                <button class="btn btn-sm btn-light text-danger" data-bs-toggle="modal" data-bs-target="#modalRFI">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0 table-center-forced align-middle">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Banco</th>
                            <th>Fundo/Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Taxa</th>
                            <th>Vencimento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in rf_ipca %}
                        <tr>
                            <td>{{ item.product_type or '-' }}</td>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td>{{ item.rate }}</td>
                            <td>{{ item.maturity_date.strftime('%d/%m/%Y') if item.maturity_date else '-' }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    </tbody>
                    <tfoot>
                        <tr class="font-weight-bold" style="background-color: rgba(255,255,255,0.05);">
                            <td colspan="3" class="text-right">TOTAL</td>
                            <td>R$ {{ types_total['Renda Fixa IPCA'] | brl_fmt }}</td>
                            <td colspan="3">-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- FUNDS & OTHERS -->
<div class="row">
    <!-- FUNDOS -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-info">
            <div
                class="card-header bg-info text-white font-weight-bold d-flex justify-content-between align-items-center">
                <span>Fundos de Investimento</span>
                <button class="btn btn-sm btn-light text-info" data-bs-toggle="modal" data-bs-target="#modalFund">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0 table-center-forced align-middle">
                    <thead>
                        <tr>
                            <th>Banco</th>
                            <th>Fundo</th>
                            <th>Valor</th>
                            <th>Indexador</th>
                            <th>Vencimento</th>
                            <th>Del</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in funds %}
                        <tr>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td>{{ item.indexer }}</td>
                            <td>{{ item.maturity_date.strftime('%d/%m/%Y') if item.maturity_date else '-' }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='fund', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='fund', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr class="font-weight-bold" style="background-color: rgba(255,255,255,0.05);">
                            <td colspan="2" class="text-right">TOTAL</td>
                            <td>R$ {{ types_total['Fundos'] | brl_fmt }}</td>
                            <td colspan="3">-</td>
                        </tr>
                    </tfoot>

                </table>
            </div>
        </div>
    </div>

    <!-- CRIPTO -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-secondary">
            <div class="card-header font-weight-bold d-flex justify-content-between align-items-center">
                <span>Criptoativos</span>
                <button class="btn btn-sm btn-light text-dark" data-bs-toggle="modal" data-bs-target="#modalCrypto">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0 table-center-forced align-middle">
                    <thead>
                        <tr>
                            <th>Exchange</th>
                            <th>Cripto</th>
                            <th>Pr. M√©dio</th>
                            <th>Qtd</th>
                            <th>Vl. Compra</th>
                            <th>Cota√ß√£o</th>
                            <th>Lucro</th>
                            <th>Valor Atual</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in cryptos %}
                        {% set invested = (item.quantity or 0) * (item.avg_price or 0) %}
                        {% set profit = item.current_value - invested %}
                        <tr>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ (item.avg_price or 0) | brl_fmt }}</td>
                            <td>{{ item.quantity if item.quantity else '-' }}</td>
                            <td>R$ {{ invested | brl_fmt }}</td>
                            <td>R$ {{ (item.quote or 0) | brl_fmt }}</td>
                            <td class="{{ 'text-success' if profit >= 0 else 'text-danger' }}">
                                R$ {{ profit | brl_fmt }}
                            </td>
                            <td>R$ {{ item.current_value | brl_fmt }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <div class="btn-group btn-group-sm" role="group">
                                    <a href="{{ url_for('buy_crypto', id=item.id) }}" class="btn btn-success"
                                        title="Comprar">‚ûï</a>
                                    <a href="{{ url_for('exit_crypto', id=item.id) }}" class="btn btn-danger"
                                        title="Vender/Sair">üõë</a>
                                    <a href="{{ url_for('edit_balance_item', type='crypto', id=item.id) }}"
                                        class="btn btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                    <a href="{{ url_for('delete_balance_item', type='crypto', id=item.id) }}"
                                        class="btn btn-danger"
                                        onclick="return confirm('Confirma a exclus√£o deste item?')"
                                        title="Excluir">üóëÔ∏è</a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr class="font-weight-bold" style="background-color: rgba(255,255,255,0.05);">
                            <td colspan="4" class="text-right">TOTAIS</td>
                            <td>R$ {{ crypto_invested | brl_fmt }}</td>
                            <td>-</td>
                            <td class="{{ 'text-success' if crypto_profit >= 0 else 'text-danger' }}">
                                R$ {{ crypto_profit | brl_fmt }}
                            </td>
                            <td>R$ {{ crypto_current | brl_fmt }}</td>
                            <td>-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- PREVIDENCIA -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-success">
            <div
                class="card-header bg-success text-white font-weight-bold d-flex justify-content-between align-items-center">
                <span>Previd√™ncia</span>
                <button class="btn btn-sm btn-light text-success" data-bs-toggle="modal" data-bs-target="#modalPension">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0 table-center-forced align-middle">
                    <thead>
                        <tr>
                            <th>Inst.</th>
                            <th>Plano</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>Del</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in pensions %}
                        <tr>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>{{ item.type }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='pension', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='pension', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    </tbody>
                    <tfoot>
                        <tr class="font-weight-bold" style="background-color: rgba(255,255,255,0.05);">
                            <td colspan="3" class="text-right">TOTAL</td>
                            <td>R$ {{ types_total['Previd√™ncia'] | brl_fmt }}</td>
                            <td>-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- INTERNATIONAL RV Removed -->

    <!-- INTERNATIONAL RF Removed -->
</div>

<style>
    /* Force Center Alignment */
    .table-center-forced th,
    .table-center-forced td {
        text-align: center !important;
        vertical-align: middle !important;
    }

    /* Disable Sticky/Freeze First Column for this page only */
    table.dataTable tbody td:first-child,
    table.dataTable thead th:first-child {
        position: static !important;
        background-color: transparent !important;
        box-shadow: none !important;
        border-right: none !important;
    }
</style>

<!-- ... (Leaving Summary Section intact based on line range) ... -->

<!-- (Below at Modal Definitions) -->

<!-- Modal Intl RF -->
<div class="modal fade" id="modalIntlRF" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_intl') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Fixa Internacional</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="RF">
                    <div class="mb-3"><label>Banco/Institui√ß√£o</label><input type="text" name="institution"
                            class="form-control" required></div>
                    <div class="mb-3"><label>C√≥digo (Ticker ex: SHV)</label><input type="text" name="name"
                            class="form-control" required style="text-transform: uppercase;"></div>
                    <div class="mb-3"><label>Tipo (ex: Treasury Bond)</label><input type="text" name="description"
                            class="form-control" required></div>
                    <div class="mb-3"><label>Quantidade</label><input type="text" name="quantity" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Custo M√©dio ($)</label><input type="text" name="avg_price"
                            class="form-control" required></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-secondary">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- SUMMARY SECTION -->
<div class="row mt-5">
    <div class="col-12">
        <h3 class="text-white border-bottom pb-2">Resumo e Balanceamento</h3>
    </div>

    <!-- Totals Table -->
    <div class="col-12 mt-3">
        <h5 class="text-white mb-2">Por Classe</h5>
        <div class="table-responsive">
            <table class="table table-dark table-bordered table-sm no-datatable table-center-forced">
                <thead>
                    <tr>
                        <th>Classe</th>
                        <th>Valor</th>
                        <th>Percentual</th>
                    </tr>
                </thead>
                <tbody>
                    {% for k, v in pie_chart_data.items() %}
                    <tr>
                        <td>{{ k }}</td>
                        <td>R$ {{ v | brl_fmt }}</td>
                        <td>
                            {% if total_portfolio > 0 %}
                            {{ (v / total_portfolio * 100) | brl_fmt }}%
                            {% else %}
                            0,00%
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    <tr class="bg-secondary font-weight-bold">
                        <td>TOTAL</td>
                        <td>R$ {{ total_portfolio | brl_fmt }}</td>
                        <td>100%</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Class Chart -->
        <div class="d-flex justify-content-center mt-3">
            <div style="max-width: 500px; width: 100%;">
                <canvas id="classChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Maturity Summary (Detailed per Type) -->
    <div class="col-12 mt-3">
        <h5 class="text-white mb-2">Por Prazo (Detalhado Renda Fixa)</h5>
        <div class="table-responsive">
            <table class="table table-dark table-bordered table-sm no-datatable table-center-forced">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Prazo</th>
                        <th>Valor</th>
                        <th>Percentual</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category, terms in maturity_breakdown.items() %}
                    {% for term, val in terms.items() %}
                    <tr>
                        {% if loop.first %}
                        <td rowspan="{{ loop.length }}" class="align-middle font-weight-bold">{{ category }}</td>
                        {% endif %}
                        <td>{{ term }}</td>
                        <td>R$ {{ val | brl_fmt }}</td>
                        <td>
                            {% if types_total[category] > 0 %}
                            {{ (val / types_total[category] * 100) | brl_fmt }}%
                            {% else %}
                            0,00%
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    <!-- Subtotal Row -->
                    <tr class="bg-secondary" style="font-weight: bold;">
                        <td colspan="2">TOTAL {{ category | upper }}</td>
                        <td>R$ {{ types_total[category] | brl_fmt }}</td>
                        <td>100,00%</td>
                    </tr>
                    {% endfor %}
                    <!-- GRAND TOTAL ROW -->
                    <tr class="bg-secondary" style="font-weight: bold; border-top: 2px solid white;">
                        <td colspan="2">TOTAL GERAL RENDA FIXA</td>
                        <td>R$ {{ total_rf_detailed | brl_fmt }}</td>
                        <td>100,00%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- NEW RF CHARTS ROW -->
        <h5 class="text-white mt-4 mb-2">Gr√°ficos Renda Fixa</h5>
        <div class="row mb-3">
            <div class="col-md-6 d-flex flex-column align-items-center">
                <h6 class="text-white">Por Prazo</h6>
                <div style="max-width: 400px; width: 100%;">
                    <canvas id="rfTermChart"></canvas>
                </div>
            </div>
            <div class="col-md-6 d-flex flex-column align-items-center">
                <h6 class="text-white">Por Tipo (Categoria)</h6>
                <div style="max-width: 400px; width: 100%;">
                    <canvas id="rfTypeChart"></canvas>
                </div>
            </div>

            <!-- RF Subtype Chart (New) -->
            <div class="col-md-6 col-lg-3 text-center mb-4">
                <h6 class="text-white">Por Subtipo (Detalhado)</h6>
                <div style="max-width: 400px; width: 100%;">
                    <canvas id="rfSubtypeChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <!-- Type Summary with Chart -->
    <div class="col-12 mt-3 mb-5">
        <h5 class="text-white mb-2">Por Tipo</h5>
        <div class="table-responsive">
            <table class="table table-dark table-bordered table-sm no-datatable table-center-forced">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Valor</th>
                        <th>Percentual</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Renda Fixa</td>
                        <td>R$ {{ summary['Renda Fixa'] | brl_fmt }}</td>
                        <td>
                            {% if total_portfolio > 0 %}
                            {{ (summary['Renda Fixa'] / total_portfolio * 100) | brl_fmt }}%
                            {% else %}
                            0,00%
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Renda Vari√°vel</td>
                        <td>R$ {{ summary['Renda Vari√°vel'] | brl_fmt }}</td>
                        <td>
                            {% if total_portfolio > 0 %}
                            {{ (summary['Renda Vari√°vel'] / total_portfolio * 100) | brl_fmt }}%
                            {% else %}
                            0,00%
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Type Chart (Below Table) -->
        <div class="d-flex justify-content-center mt-3">
            <div style="max-width: 500px; width: 100%;">
                <canvas id="typeChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Register DataLabels
        Chart.register(ChartDataLabels);

        // ... (commonOptions definition logic remains same, just ensuring script tag is there) ...
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right', labels: { color: 'white', font: { size: 12 } } },

                // DATA LABELS CONFIGURATION
                datalabels: {
                    color: '#fff',
                    font: { weight: 'bold', size: 14 },
                    formatter: function (value, ctx) {
                        var sum = 0;
                        var dataArr = ctx.chart.data.datasets[0].data;
                        dataArr.map(function (data) {
                            sum += data;
                        });
                        var percentage = (value * 100 / sum).toFixed(1) + "%";
                        return percentage;
                    },
                    anchor: 'center', // Put it inside
                    align: 'center'
                }
            },
            layout: { padding: 20 }
        };

        // --- TYPE CHART ---
        const ctxType = document.getElementById('typeChart').getContext('2d');
        new Chart(ctxType, {
            type: 'pie',
            data: {
                labels: ['Renda Fixa', 'Renda Vari√°vel'],
                datasets: [{
                    data: [{{ summary['Renda Fixa'] }}, {{ summary['Renda Vari√°vel'] }}],
            backgroundColor: ['#3b82f6', '#10b981'],
            borderWidth: 1,
            borderColor: '#1e293b'
        }]
            },
        options: commonOptions
        });

    // --- CLASS CHART ---
    const ctxClass = document.getElementById('classChart').getContext('2d');

    // Prepare data from Jinja loop
    const classLabels = [];
    const classData = [];
    {% for k, v in pie_chart_data.items() %}
    classLabels.push('{{ k }}');
    classData.push({{ v }});
    {% endfor %}

    // Colors for classes
    const classColors = [
        '#ef4444', '#f97316', '#f59e0b', '#84cc16', '#10b981',
        '#06b6d4', '#3b82f6', '#6366f1', '#8b5cf6', '#d946ef', '#f43f5e'
    ];

    new Chart(ctxClass, {
        type: 'pie',
        data: {
            labels: classLabels,
            datasets: [{
                data: classData,
                backgroundColor: classColors,
                borderWidth: 1,
                borderColor: '#1e293b'
            }]
        },
        options: commonOptions
    });

    // --- RF TERM CHART ---
    const ctxRfTerm = document.getElementById('rfTermChart').getContext('2d');
    const rfTermLabels = [];
    const rfTermData = [];
    {% for k, v in rf_chart_term.items() %}
    {% if v > 0 %}
    rfTermLabels.push('{{ k }}');
    rfTermData.push({{ v }});
    {% endif %}
    {% endfor %}

    new Chart(ctxRfTerm, {
        type: 'pie',
        data: {
            labels: rfTermLabels,
            datasets: [{
                data: rfTermData,
                backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#6366f1'], // Red, Orange, Green, Indigo for terms
                borderWidth: 1,
                borderColor: '#1e293b'
            }]
        },
        options: commonOptions
    });

    // --- RF TYPE CHART ---
    const ctxRfType = document.getElementById('rfTypeChart').getContext('2d');
    const rfTypeLabels = [];
    const rfTypeData = [];
    {% for k, v in rf_chart_type.items() %}
    {% if v > 0 %}
    rfTypeLabels.push('{{ k }}');
    rfTypeData.push({{ v }});
    {% endif %}
    {% endfor %}

    new Chart(ctxRfType, {
        type: 'pie',
        data: {
            labels: rfTypeLabels,
            datasets: [{
                data: rfTypeData,
                backgroundColor: ['#3b82f6', '#f43f5e', '#8b5cf6', '#06b6d4'], // Different palette
                borderWidth: 1,
                borderColor: '#1e293b'
            }]
        },
        options: commonOptions
    });

    // --- RF SUBTYPE CHART (NEW) ---
    const subCanvas = document.getElementById('rfSubtypeChart');
    if (subCanvas) {
        const ctxRfSubtype = subCanvas.getContext('2d');
        const rfSubtypeLabels = [];
        const rfSubtypeData = [];

        {% if rf_subtypes %}
        {% for k, v in rf_subtypes.items() %}
        {% if v > 0 %}
        rfSubtypeLabels.push('{{ k }}');
        rfSubtypeData.push({{ v }});
    {% endif %}
    {% endfor %}
    {% endif %}

    new Chart(ctxRfSubtype, {
        type: 'pie',
        data: {
            labels: rfSubtypeLabels,
            datasets: [{
                data: rfSubtypeData,
                backgroundColor: [
                    '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
                    '#8b5cf6', '#ec4899', '#06b6d4', '#6366f1', '#14b8a6'
                ],
                borderWidth: 1,
                borderColor: '#1e293b'
            }]
        },
        options: commonOptions
    });
    }

    });
</script>

<!-- LOCATION BREAKDOWN -->
<!-- Stacked Layout: Table Top, Chart Bottom -->
<div class="col-12 mt-5 mb-5">
    <h5 class="text-white mb-2">Por Localiza√ß√£o</h5>

    <!-- Table -->
    <div class="card bg-dark text-white border-secondary mb-4">
        <div class="card-body p-0">
            <table class="table table-dark table-striped mb-0 table-center-forced">
                <thead>
                    <tr>
                        <th>Localiza√ß√£o</th>
                        <th>Valor Total</th>
                        <th>Percentual</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Brasil</td>
                        <td>R$ {{ location_chart['Brasil'] | brl_fmt }}</td>
                        <td>
                            {% if total_portfolio > 0 %}
                            {{ '%.1f' | format(location_chart['Brasil'] / total_portfolio * 100) }}%
                            {% else %}
                            0.0%
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Internacional</td>
                        <td>R$ {{ location_chart['Internacional'] | brl_fmt }}</td>
                        <td>
                            {% if total_portfolio > 0 %}
                            {{ '%.1f' | format(location_chart['Internacional'] / total_portfolio * 100) }}%
                            {% else %}
                            0.0%
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr class="font-weight-bold" style="background-color: rgba(255,255,255,0.05);">
                        <td>TOTAL</td>
                        <td>R$ {{ total_portfolio | brl_fmt }}</td>
                        <td>100.0%</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Chart -->
    <div class="d-flex justify-content-center mt-3">
        <div style="max-width: 500px; width: 100%;">
            <canvas id="chartLocation"></canvas>
        </div>
    </div>
</div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Options matching commonOptions from main script
        const locOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right', labels: { color: 'white', font: { size: 12 } } },

                // DataLabels matching existing style
                datalabels: {
                    color: '#fff',
                    font: { weight: 'bold', size: 14 },
                    formatter: function (value, ctx) {
                        var sum = 0;
                        var dataArr = ctx.chart.data.datasets[0].data;
                        dataArr.map(function (data) {
                            sum += data;
                        });
                        var percentage = (value * 100 / sum).toFixed(1) + "%";
                        return percentage;
                    },
                    anchor: 'center',
                    align: 'center'
                },
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed !== null) {
                                label += new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(context.parsed);
                            }
                            return label;
                        }
                    }
                }
            },
            layout: { padding: 20 }
        };

        const ctxLoc = document.getElementById('chartLocation').getContext('2d');
        new Chart(ctxLoc, {
            type: 'pie',
            data: {
                labels: ['Brasil', 'Internacional'],
                datasets: [{
                    data: [{{ location_chart['Brasil'] }}, {{ location_chart['Internacional'] }}],
            backgroundColor: ['#28a745', '#3b82f6'], // Green (BR), Blue (Intl) - Using compatible hex
            borderWidth: 1,
            borderColor: '#1e293b'
        }]
            },
        options: locOptions
        });
    });
</script>

<!-- NEW SUMMARIES (HIERARCHY / EXPLODED / GENERAL) -->
<div class="row mt-5">

    <!-- 1. HIERARCHY TABLE -->
    <div class="col-12 mb-5">
        <h4 class="text-white border-bottom pb-2">Somat√≥rio Geral (Detalhado)</h4>
        <div class="table-responsive">
            <table class="table table-dark table-bordered table-sm no-datatable table-center-forced align-middle">
                <thead>
                    <tr>
                        <th>Grupo</th>
                        <th>Categoria</th>
                        <th>Valor</th>
                        <th>Percentual Parcial</th>
                        <th>Percentual Geral</th>
                    </tr>
                </thead>
                <tbody>
                    {% for group in summary_hierarchy %}
                    {% for line in group.lines %}
                    <tr>
                        {% if loop.first %}
                        <td rowspan="{{ loop.length + 1 }}" style="vertical-align: middle; font-weight: bold;">{{
                            group.group }}</td>
                        {% endif %}
                        <td>{{ line.label }}</td>
                        <td>R$ {{ line.value | brl_fmt }}</td>
                        <td>
                            {% if group.total > 0 %}
                            {{ (line.value / group.total * 100) | brl_fmt }}%
                            {% else %}
                            0,00%
                            {% endif %}
                        </td>
                        <td>{{ line.pct | brl_fmt }}%</td>
                    </tr>
                    {% endfor %}
                    <!-- Group Total Row -->
                    <tr class="bg-secondary" style="font-weight: bold;">
                        <td>TOTAL</td>
                        <td>R$ {{ group.total | brl_fmt }}</td>
                        <td>100,00%</td>
                        <td>{{ group.total_pct | brl_fmt }}%</td>
                    </tr>
                    {% endfor %}
                    <!-- GRAND TOTAL -->
                    <tr class="bg-primary text-white" style="font-weight: bold; font-size: 1.1em;">
                        <td colspan="2">TOTAL GERAL</td>
                        <td>R$ {{ total_portfolio | brl_fmt }}</td>
                        <td>-</td>
                        <td>100,00%</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- NEW: HIERARCHY CHART CENTERED BELOW -->
        <h5 class="text-white mt-4 text-center">Gr√°fico por Grandes Grupos</h5>
        <div class="row justify-content-center">
            <div class="col-md-8 d-flex justify-content-center">
                <div style="max-width: 500px; width: 100%;">
                    <canvas id="chartHierarchy"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 2. EXPLODED BALANCE (CHART + TABLE STACKED) -->
    <div class="col-12 mb-5">
        <h4 class="text-white border-bottom pb-2">Balanceamento Explodido</h4>

        <!-- Table Centered -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <table class="table table-dark table-sm table-striped no-datatable mb-0 table-center-forced">
                    <thead>
                        <tr>
                            <th>Categoria</th>
                            <th>Percentual</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for label, val in summary_exploded.items() %}
                        <tr>
                            <td>{{ label }}</td>
                            <td>
                                {% if total_portfolio > 0 %}
                                {{ (val / total_portfolio * 100) | brl_fmt }}%
                                {% else %}
                                0,00%
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Chart Centered Below -->
        <div class="row mt-4">
            <div class="col-12 d-flex justify-content-center">
                <div style="max-width: 600px; width: 100%;">
                    <canvas id="chartExploded"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. GENERAL BALANCE (CHART + TABLE STACKED) -->
    <div class="col-12 mb-5">
        <h4 class="text-white border-bottom pb-2">Balanceamento Geral</h4>

        <!-- Table Centered -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <table class="table table-dark table-sm table-striped no-datatable mb-0 table-center-forced">
                    <thead>
                        <tr>
                            <th>Categoria</th>
                            <th>Percentual</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for label, val in summary_general.items() %}
                        <tr>
                            <td>{{ label }}</td>
                            <td>
                                {% if total_portfolio > 0 %}
                                {{ (val / total_portfolio * 100) | brl_fmt }}%
                                {% else %}
                                0,00%
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                        <tr class="font-weight-bold border-top">
                            <td>TOTAL</td>
                            <td>100,00%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Chart Centered Below -->
        <div class="row mt-4">
            <div class="col-12 d-flex justify-content-center">
                <div style="max-width: 600px; width: 100%;">
                    <canvas id="chartGeneral"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- HIERARCHY GROUP CHART (NEW) ---
        const ctxHier = document.getElementById('chartHierarchy').getContext('2d');
        const hierLabels = [];
        const hierData = [];

        // Loop Jinja to get groups and totals
        {% for group in summary_hierarchy %}
        hierLabels.push('{{ group.group }}');
        hierData.push({{ group.total }});
    {% endfor %}

    new Chart(ctxHier, {
        type: 'pie',
        data: {
            labels: hierLabels,
            datasets: [{
                data: hierData,
                backgroundColor: ['#3b82f6', '#10b981', '#8b5cf6'], // Blue (RF), Green (RV BR), Purple (Intl)
                borderWidth: 1,
                borderColor: '#1e293b'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { color: 'white' } },
                datalabels: {
                    color: '#fff',
                    font: { weight: 'bold', size: 14 },
                    formatter: (value, ctx) => {
                        let sum = 0;
                        let dataArr = ctx.chart.data.datasets[0].data;
                        dataArr.map(data => { sum += data; });
                        return (value * 100 / sum).toFixed(1) + "%";
                    }
                }
            }
        }
    });

    // --- EXPLODED CHART ---
    const ctxExp = document.getElementById('chartExploded').getContext('2d');
    const expLabels = [];
    const expData = [];
    // Loop Jinja items
    {% for k, v in summary_exploded.items() %}
    expLabels.push('{{ k }}');
    expData.push({{ v }});
    {% endfor %}

    new Chart(ctxExp, {
        type: 'doughnut', // Exploded usually Donut or Pie
        data: {
            labels: expLabels,
            datasets: [{
                data: expData,
                backgroundColor: [
                    '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd',
                    '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf'
                ],
                borderWidth: 1,
                borderColor: '#1e293b'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { color: 'white' } },
                title: { display: true, text: 'Balanceamento Explodido', color: 'white', font: { size: 16 } },
                datalabels: {
                    color: '#fff',
                    font: { weight: 'bold' },
                    formatter: (value, ctx) => {
                        let sum = 0;
                        let dataArr = ctx.chart.data.datasets[0].data;
                        dataArr.map(data => { sum += data; });
                        return (value * 100 / sum).toFixed(1) + "%";
                    }
                }
            }
        }
    });

    // --- GENERAL CHART ---
    const ctxGen = document.getElementById('chartGeneral').getContext('2d');
    const genLabels = [];
    const genData = [];
    {% for k, v in summary_general.items() %}
    genLabels.push('{{ k }}');
    genData.push({{ v }});
    {% endfor %}

    new Chart(ctxGen, {
        type: 'doughnut',
        data: {
            labels: genLabels,
            datasets: [{
                data: genData,
                backgroundColor: [
                    '#0d47a1', '#e65100', '#1b5e20', '#00acc1', '#8e24aa'
                ], // Deep Colors: Blue, Orange, Green, Cyan, Purple
                borderWidth: 1,
                borderColor: '#1e293b'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { color: 'white' } },
                title: { display: true, text: 'Balanceamento Geral', color: 'white', font: { size: 16 } },
                datalabels: {
                    color: '#fff',
                    font: { weight: 'bold' },
                    formatter: (value, ctx) => {
                        let sum = 0;
                        let dataArr = ctx.chart.data.datasets[0].data;
                        dataArr.map(data => { sum += data; });
                        return (value * 100 / sum).toFixed(1) + "%";
                    }
                }
            }
        }
    });
    });
</script>

<!-- MODALS -->
<!-- Modal RF P√≥s -->
<div class="modal fade" id="modalRFC" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_rf') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Fixa P√≥s</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="POS">
                    <div class="mb-3">
                        <label>Tipo</label>
                        <select name="product_type" class="form-control mb-2">
                            <option value="CDB">CDB</option>
                            <option value="LCI">LCI</option>
                            <option value="LCA">LCA</option>
                            <option value="CRI">CRI</option>
                            <option value="CRA">CRA</option>
                            <option value="Tesouro">Tesouro</option>
                            <option value="RDB">RDB</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Banco</label><input type="text" name="institution" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Fundo/Descri√ß√£o</label><input type="text" name="name" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Taxa (ex: 120% CDI)</label><input type="text" name="rate"
                            class="form-control"></div>
                    <div class="mb-3"><label>Vencimento</label><input type="date" name="maturity_date"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-primary">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal RF Pr√© -->
<div class="modal fade" id="modalRFP" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_rf') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Fixa Pr√©</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="PRE">
                    <div class="mb-3">
                        <label>Tipo</label>
                        <select name="product_type" class="form-control mb-2">
                            <option value="CDB">CDB</option>
                            <option value="LCI">LCI</option>
                            <option value="LCA">LCA</option>
                            <option value="CRI">CRI</option>
                            <option value="CRA">CRA</option>
                            <option value="Tesouro">Tesouro</option>
                            <option value="RDB">RDB</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Banco</label><input type="text" name="institution" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Descri√ß√£o</label><input type="text" name="name" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Taxa (ex: 12% a.a.)</label><input type="text" name="rate"
                            class="form-control"></div>
                    <div class="mb-3"><label>Vencimento</label><input type="date" name="maturity_date"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-warning">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal RF IPCA -->
<div class="modal fade" id="modalRFI" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_rf') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Fixa IPCA</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="IPCA">
                    <div class="mb-3">
                        <label>Tipo</label>
                        <select name="product_type" class="form-control mb-2">
                            <option value="CDB">CDB</option>
                            <option value="LCI">LCI</option>
                            <option value="LCA">LCA</option>
                            <option value="CRI">CRI</option>
                            <option value="CRA">CRA</option>
                            <option value="Tesouro">Tesouro</option>
                            <option value="RDB">RDB</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Banco</label><input type="text" name="institution" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Descri√ß√£o</label><input type="text" name="name" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Taxa (ex: IPCA+6%)</label><input type="text" name="rate"
                            class="form-control"></div>
                    <div class="mb-3"><label>Vencimento</label><input type="date" name="maturity_date"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-danger">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Fundos -->
<div class="modal fade" id="modalFund" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_fund') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Fundo</h5><button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="IPCA">
                    <div class="mb-3">
                        <label>Tipo</label>
                        <select name="product_type" class="form-control mb-2">
                            <option value="CDB">CDB</option>
                            <option value="LCI">LCI</option>
                            <option value="LCA">LCA</option>
                            <option value="CRI">CRI</option>
                            <option value="CRA">CRA</option>
                            <option value="Tesouro">Tesouro</option>
                            <option value="RDB">RDB</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Banco</label><input type="text" name="institution" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Fundo</label><input type="text" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Indexador</label><input type="text" name="indexer" class="form-control">
                    </div>
                    <div class="mb-3"><label>Vencimento (Opcional)</label><input type="date" name="maturity_date"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-info">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Crypto -->
<div class="modal fade" id="modalCrypto" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_crypto') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Cripto</h5><button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3"><label>Exchange</label><input type="text" name="institution" class="form-control">
                    </div>
                    <div class="mb-3"><label>Nome (ex: BTC)</label><input type="text" name="name" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Quantidade</label><input type="text" name="quantity" class="form-control">
                    </div>
                    <div class="mb-3"><label>Valor Investido (R$)</label><input type="text" name="invested_value"
                            class="form-control"></div>
                    <div class="mb-3"><label>Valor Atual (R$)</label><input type="text" name="current_value"
                            class="form-control" required></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-dark">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Pension -->
<div class="modal fade" id="modalPension" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_pension') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Previd√™ncia</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3"><label>Institui√ß√£o</label><input type="text" name="institution"
                            class="form-control" required></div>
                    <div class="mb-3"><label>Plano</label><input type="text" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Tipo</label>
                        <select name="type" class="form-control">
                            <option value="Renda Fixa">Renda Fixa</option>
                            <option value="Acao">A√ß√£o</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Certificado (Opcional)</label><input type="text" name="certificate"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-success">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Intl RV -->
<div class="modal fade" id="modalIntlRV" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_intl') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Vari√°vel Internacional</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="RV">
                    <div class="mb-3"><label>Corretora/Institui√ß√£o</label><input type="text" name="institution"
                            class="form-control" required></div>
                    <div class="mb-3"><label>Ticker (ex: AAPL)</label><input type="text" name="name"
                            class="form-control" required style="text-transform: uppercase;"></div>
                    <div class="mb-3"><label>Quantidade</label><input type="text" name="quantity" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Pre√ßo M√©dio ($)</label><input type="text" name="avg_price"
                            class="form-control" required>
                    </div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-secondary">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Intl RF -->
<div class="modal fade" id="modalIntlRF" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_intl') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Fixa Internacional</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="RF">
                    <div class="mb-3"><label>Institui√ß√£o</label><input type="text" name="institution"
                            class="form-control" required></div>
                    <div class="mb-3"><label>Descri√ß√£o/Tipo</label><input type="text" name="description"
                            class="form-control" required></div>
                    <div class="mb-3"><label>Valor Investido ($)</label><input type="text" name="value_usd"
                            class="form-control" required></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-secondary">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

</form>
</div>
</div>
{% endblock %}