{% extends 'base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card">
            <h3 class="mb-4 text-center">Editar Item - {% if type == 'rf' %}Renda Fixa{% elif type == 'fund' %}Fundo{%
                elif type == 'crypto' %}Cripto{% elif type == 'pension' %}Previdência{% elif type == 'intl'
                %}Internacional{% endif %}</h3>

            <form method="POST">
                {% if type == 'rf' %}
                <div class="mb-3">
                    <label>Categoria</label>
                    <input type="text" class="form-control" value="{{ item.category }}" disabled>
                </div>
                <div class="mb-3">
                    <label>Tipo</label>
                    <select name="product_type" class="form-control mb-2">
                        <option value="CDB" {% if item.product_type=='CDB' %}selected{% endif %}>CDB</option>
                        <option value="LCI" {% if item.product_type=='LCI' %}selected{% endif %}>LCI</option>
                        <option value="LCA" {% if item.product_type=='LCA' %}selected{% endif %}>LCA</option>
                        <option value="CRI" {% if item.product_type=='CRI' %}selected{% endif %}>CRI</option>
                        <option value="CRA" {% if item.product_type=='CRA' %}selected{% endif %}>CRA</option>
                        <option value="Tesouro" {% if item.product_type=='Tesouro' %}selected{% endif %}>Tesouro
                        </option>
                        <option value="RDB" {% if item.product_type=='RDB' %}selected{% endif %}>RDB</option>
                        <option value="Outros" {% if item.product_type=='Outros' %}selected{% endif %}>Outros</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label>Instituição</label>
                    <input type="text" name="institution" class="form-control" value="{{ item.institution }}" required>
                </div>
                <div class="mb-3">
                    <label>Nome/Descrição</label>
                    <input type="text" name="name" class="form-control" value="{{ item.name }}" required>
                </div>
                <div class="mb-3">
                    <label>Valor (R$)</label>
                    <input type="text" name="value" class="form-control"
                        value="{{ '%.2f'|format(item.value)|replace('.', ',') }}" required>
                </div>
                <div class="mb-3">
                    <label>Taxa</label>
                    <input type="text" name="rate" class="form-control" value="{{ item.rate }}">
                </div>
                <div class="mb-3">
                    <label>Vencimento</label>
                    <input type="date" name="maturity_date" class="form-control"
                        value="{{ item.maturity_date.strftime('%Y-%m-%d') if item.maturity_date else '' }}">
                </div>

                {% elif type == 'fund' %}
                <div class="mb-3">
                    <label>Instituição</label>
                    <input type="text" name="institution" class="form-control" value="{{ item.institution }}" required>
                </div>
                <div class="mb-3">
                    <label>Nome do Fundo</label>
                    <input type="text" name="name" class="form-control" value="{{ item.name }}" required>
                </div>
                <div class="mb-3">
                    <label>Valor (R$)</label>
                    <input type="text" name="value" class="form-control"
                        value="{{ '%.2f'|format(item.value)|replace('.', ',') }}" required>
                </div>
                <div class="mb-3">
                    <label>Indexador</label>
                    <input type="text" name="indexer" class="form-control" value="{{ item.indexer }}">
                </div>
                <div class="mb-3">
                    <label>Vencimento</label>
                    <input type="date" name="maturity_date" class="form-control"
                        value="{{ item.maturity_date.strftime('%Y-%m-%d') if item.maturity_date else '' }}">
                </div>

                {% elif type == 'crypto' %}
                <div class="mb-3">
                    <label>Exchange</label>
                    <input type="text" name="institution" class="form-control" value="{{ item.institution }}">
                </div>
                <div class="mb-3">
                    <label>Nome (Ticker)</label>
                    <input type="text" name="name" class="form-control" value="{{ item.name }}" required>
                </div>
                <div class="mb-3">
                    <label>Quantidade</label>
                    <input type="text" name="quantity" class="form-control" value="{{ item.quantity }}">
                </div>
                <div class="mb-3">
                    <label>Preço Médio (R$)</label>
                    <input type="text" name="avg_price" class="form-control"
                        value="{{ '%.2f'|format(item.avg_price or 0)|replace('.', ',') }}">
                </div>
                <div class="mb-3">
                    <label>Valor Atual (R$)</label>
                    <input type="text" name="current_value" class="form-control"
                        value="{{ '%.2f'|format(item.current_value)|replace('.', ',') }}" required>
                </div>

                {% elif type == 'pension' %}
                <div class="mb-3">
                    <label>Instituição</label>
                    <input type="text" name="institution" class="form-control" value="{{ item.institution }}" required>
                </div>
                <div class="mb-3">
                    <label>Plano</label>
                    <input type="text" name="name" class="form-control" value="{{ item.name }}" required>
                </div>
                <div class="mb-3">
                    <label>Valor (R$)</label>
                    <input type="text" name="value" class="form-control"
                        value="{{ '%.2f'|format(item.value)|replace('.', ',') }}" required>
                </div>
                <div class="mb-3">
                    <label>Tipo</label>
                    <select name="type" class="form-control">
                        <option value="Renda Fixa" {% if item.type=='Renda Fixa' %}selected{% endif %}>Renda Fixa
                        </option>
                        <option value="Acao" {% if item.type=='Acao' %}selected{% endif %}>Ação</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label>Certificado</label>
                    <input type="text" name="certificate" class="form-control" value="{{ item.certificate }}">
                </div>

                {% elif type == 'intl' %}

                {% if item.category == 'RF' and (not item.name or item.name == 'Renda Fixa') %}
                <!-- Legacy International RF -->
                <div class="mb-3">
                    <label>Banco</label>
                    <input type="text" name="institution" class="form-control" value="{{ item.institution }}" required>
                </div>
                <div class="mb-3">
                    <label>Tipo</label>
                    <input type="text" name="description" class="form-control" value="{{ item.description }}">
                </div>
                <div class="mb-3">
                    <label>Valor Investido (USD)</label>
                    <input type="text" name="invested_value" class="form-control"
                        value="{{ '%.2f'|format(item.invested_value or 0)|replace('.', ',') }}">
                </div>
                <div class="mb-3">
                    <label>Valor Atualizado (USD)</label>
                    <input type="text" name="value_usd" class="form-control"
                        value="{{ '%.2f'|format(item.value_usd)|replace('.', ',') }}" required>
                </div>
                {% else %}
                <!-- International RV and Asset-based RF -->
                <div class="mb-3">
                    <label>Instituição / Corretora</label>
                    <input type="text" name="institution" class="form-control" value="{{ item.institution }}" required>
                </div>
                <div class="mb-3">
                    <label>Ativo / Ticker</label>
                    <input type="text" name="name" class="form-control" value="{{ item.name }}" required>
                </div>

                <div class="mb-3">
                    <label>Descrição / Tipo (Opcional)</label>
                    <input type="text" name="description" class="form-control" value="{{ item.description or '' }}">
                </div>

                <div class="mb-3">
                    <label>Quantidade</label>
                    <input type="text" name="quantity" class="form-control" value="{{ item.quantity }}">
                </div>
                <div class="mb-3">
                    <label>Preço Médio (USD)</label>
                    <input type="text" name="avg_price" class="form-control"
                        value="{{ '%.2f'|format(item.avg_price or 0)|replace('.', ',') }}">
                </div>
                <div class="mb-3">
                    <label>Cotação Atual (USD)</label>
                    <input type="text" name="quote" class="form-control"
                        value="{{ '%.2f'|format(item.quote or 0)|replace('.', ',') }}">
                </div>
                {% endif %}

                <div class="mb-3">
                    <label>Cotação Dólar (R$)</label>
                    <input type="text" name="rate_usd" class="form-control"
                        value="{{ '%.2f'|format(item.rate_usd or 5.50)|replace('.', ',') }}">
                </div>
                {% endif %}

                <div class="mt-4" style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Salvar Alterações</button>
                    <a href="{{ url_for('balanceamento') }}" class="btn btn-secondary" style="flex: 1;">Cancelar</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}