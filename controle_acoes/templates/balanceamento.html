{% extends 'base.html' %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<style>
    /* Force Dark Theme Override */
    body {
        background-color: var(--bg-color) !important;
        color: var(--text-primary) !important;
    }

    .card {
        background-color: var(--card-bg) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
    }

    .modal-content {
        background-color: var(--card-bg);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .modal-header,
    .modal-footer {
        border-color: var(--border-color);
    }

    .form-control,
    .form-select {
        background-color: #334155;
        /* Slate 700 */
        color: #fff;
        border-color: #475569;
    }

    .form-control:focus,
    .form-select:focus {
        background-color: #334155;
        color: #fff;
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.25);
    }

    /* Fix table transparency */
    .table {
        color: var(--text-primary) !important;
    }
</style>

<div class="row mb-4">
    <div class="col-12">
        <h2 class="text-white"><i class="fas fa-balance-scale"></i> Balanceamento de Carteira</h2>
    </div>
</div>

<!-- Add Buttons Row -->
<div class="row mb-4">
    <div class="col-12">
        <button class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#modalRFC"><i
                class="fas fa-plus"></i> Renda Fixa P√≥s</button>
        <button class="btn btn-warning me-2" data-bs-toggle="modal" data-bs-target="#modalRFP"><i
                class="fas fa-plus"></i> Renda Fixa Pr√©</button>
        <button class="btn btn-danger me-2" data-bs-toggle="modal" data-bs-target="#modalRFI"><i
                class="fas fa-plus"></i> Renda Fixa IPCA</button>
        <button class="btn btn-info me-2" data-bs-toggle="modal" data-bs-target="#modalFund"><i class="fas fa-plus"></i>
            Fundos</button>
        <button class="btn btn-dark me-2" data-bs-toggle="modal" data-bs-target="#modalCrypto"><i
                class="fas fa-coins"></i> Cripto</button>
        <button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#modalPension"><i
                class="fas fa-piggy-bank"></i> Previd√™ncia</button>
        <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#modalIntl"><i
                class="fas fa-globe"></i> Internacional</button>
    </div>
</div>

<!-- RENDA FIXA TABLES -->
<div class="row">
    <!-- POS FIXADA -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-primary">
            <div
                class="card-header bg-primary text-white font-weight-bold d-flex justify-content-between align-items-center">
                <span>Renda Fixa P√≥s-Fixada</span>
                <button class="btn btn-sm btn-light text-primary" data-bs-toggle="modal" data-bs-target="#modalRFC">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Banco</th>
                            <th>Fundo/Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Taxa</th>
                            <th>Vencimento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in rf_pos %}
                        <tr>
                            <td>{{ item.product_type or '-' }}</td>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td>{{ item.rate }}</td>
                            <td>{{ item.maturity_date.strftime('%d/%m/%Y') if item.maturity_date else '-' }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- PRE FIXADA -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-warning">
            <div
                class="card-header bg-warning text-dark font-weight-bold d-flex justify-content-between align-items-center">
                <span>Renda Fixa Pr√©-Fixada</span>
                <button class="btn btn-sm btn-dark text-warning" data-bs-toggle="modal" data-bs-target="#modalRFP">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Banco</th>
                            <th>Fundo/Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Taxa</th>
                            <th>Vencimento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in rf_pre %}
                        <tr>
                            <td>{{ item.product_type }}</td>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td>{{ item.rate }}</td>
                            <td>{{ item.maturity_date.strftime('%d/%m/%Y') if item.maturity_date else '-' }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- IPCA -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-danger">
            <div
                class="card-header bg-danger text-white font-weight-bold d-flex justify-content-between align-items-center">
                <span>Renda Fixa Infla√ß√£o (IPCA)</span>
                <button class="btn btn-sm btn-light text-danger" data-bs-toggle="modal" data-bs-target="#modalRFI">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Banco</th>
                            <th>Fundo/Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Taxa</th>
                            <th>Vencimento</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in rf_ipca %}
                        <tr>
                            <td>{{ item.product_type or '-' }}</td>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td>{{ item.rate }}</td>
                            <td>{{ item.maturity_date.strftime('%d/%m/%Y') if item.maturity_date else '-' }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='rf', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- FUNDS & OTHERS -->
<div class="row">
    <!-- FUNDOS -->
    <div class="col-md-6 mb-4">
        <div class="card bg-dark text-white border-info">
            <div
                class="card-header bg-info text-white font-weight-bold d-flex justify-content-between align-items-center">
                <span>Fundos de Investimento</span>
                <button class="btn btn-sm btn-light text-info" data-bs-toggle="modal" data-bs-target="#modalFund">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Banco</th>
                            <th>Fundo</th>
                            <th>Valor</th>
                            <th>Indexador</th>
                            <th>Vencimento</th>
                            <th>Del</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in funds %}
                        <tr>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td>{{ item.indexer }}</td>
                            <td>{{ item.maturity_date.strftime('%d/%m/%Y') if item.maturity_date else '-' }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='fund', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='fund', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- CRIPTO -->
    <div class="col-md-6 mb-4">
        <div class="card bg-dark text-white border-secondary">
            <div class="card-header font-weight-bold d-flex justify-content-between align-items-center">
                <span>Criptoativos</span>
                <button class="btn btn-sm btn-light text-dark" data-bs-toggle="modal" data-bs-target="#modalCrypto">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Exchange</th>
                            <th>Nome</th>
                            <th>Qtd</th>
                            <th>Valor Atual</th>
                            <th>Del</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in cryptos %}
                        <tr>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>{{ item.quantity | brl_fmt }}</td>
                            <td>R$ {{ item.current_value | brl_fmt }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='crypto', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='crypto', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- PREVIDENCIA -->
    <div class="col-md-6 mb-4">
        <div class="card bg-dark text-white border-success">
            <div
                class="card-header bg-success text-white font-weight-bold d-flex justify-content-between align-items-center">
                <span>Previd√™ncia</span>
                <button class="btn btn-sm btn-light text-success" data-bs-toggle="modal" data-bs-target="#modalPension">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Inst.</th>
                            <th>Plano</th>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>Del</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in pensions %}
                        <tr>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>{{ item.type }}</td>
                            <td>R$ {{ item.value | brl_fmt }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='pension', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='pension', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- INTERNATIONAL RV -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-secondary">
            <div class="card-header font-weight-bold d-flex justify-content-between align-items-center">
                <span>Renda Vari√°vel Internacional</span>
                <button class="btn btn-sm btn-light text-dark" data-bs-toggle="modal" data-bs-target="#modalIntlRV">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Corretora</th>
                            <th>A√ß√£o</th>
                            <th>Quantidade</th>
                            <th>Vl. Compra</th>
                            <th>Cota√ß√£o</th>
                            <th>Lucro ($)</th>
                            <th>Total ($)</th>
                            <th>C√¢mbio (R$)</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in intls_rv %}
                        <tr>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.name }}</td>
                            <td>{{ item.quantity | default(0) }}</td>
                            <td>$ {{ item.avg_price | brl_fmt }}</td>
                            <td>$ {{ item.quote | brl_fmt }}</td>
                            {% set quote = item.quote or 0 %}
                            {% set avg_price = item.avg_price or 0 %}
                            {% set quantity = item.quantity or 0 %}
                            {% set profit = (quote - avg_price) * quantity %}
                            <td class="{{ 'text-success' if profit >= 0 else 'text-danger' }}">
                                $ {{ profit | brl_fmt }}
                            </td>
                            <td>$ {{ (quantity * quote) | brl_fmt }}</td>
                            <td>R$ {{ item.rate_usd | brl_fmt }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='intl', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='intl', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- INTERNATIONAL RF -->
    <div class="col-12 mb-4">
        <div class="card bg-dark text-white border-secondary">
            <div class="card-header font-weight-bold d-flex justify-content-between align-items-center">
                <span>Renda Fixa Internacional</span>
                <button class="btn btn-sm btn-light text-dark" data-bs-toggle="modal" data-bs-target="#modalIntlRF">
                    <i class="fas fa-plus"></i> Adicionar
                </button>
            </div>
            <div class="card-body p-0 table-responsive">
                <table class="table table-dark table-striped mb-0">
                    <thead>
                        <tr>
                            <th>Banco</th>
                            <th>Tipo</th>
                            <th>Vl. Investido ($)</th>
                            <th>Vl. Atualizado ($)</th>
                            <th>C√¢mbio (R$)</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in intls_rf %}
                        <tr>
                            <td>{{ item.institution }}</td>
                            <td>{{ item.description }}</td>
                            <td>$ {{ item.invested_value | brl_fmt }}</td>
                            <td>$ {{ item.value_usd | brl_fmt }}</td>
                            <td>R$ {{ item.rate_usd | brl_fmt }}</td>
                            <td class="actions" style="display: flex; gap: 5px; justify-content: center;">
                                <a href="{{ url_for('edit_balance_item', type='intl', id=item.id) }}"
                                    class="btn btn-sm btn-info" style="color: white;" title="Editar">‚úèÔ∏è</a>
                                <a href="{{ url_for('delete_balance_item', type='intl', id=item.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Confirma a exclus√£o deste item?')" title="Excluir">üóëÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
    /* Force Center Alignment */
    .table-center-forced th,
    .table-center-forced td {
        text-align: center !important;
        vertical-align: middle !important;
    }
</style>

<!-- SUMMARY SECTION -->
<div class="row mt-5">
    <div class="col-12">
        <h3 class="text-white border-bottom pb-2">Resumo e Balanceamento</h3>
    </div>

    <!-- Totals Table -->
    <div class="col-12 mt-3">
        <h5 class="text-white mb-2">Por Classe</h5>
        <div class="table-responsive">
            <table class="table table-dark table-bordered table-sm no-datatable table-center-forced">
                <thead>
                    <tr>
                        <th>Classe</th>
                        <th>Valor</th>
                        <th>Percentual</th>
                    </tr>
                </thead>
                <tbody>
                    {% for k, v in types_total.items() %}
                    <tr>
                        <td>{{ k }}</td>
                        <td>R$ {{ v | brl_fmt }}</td>
                        <td>{{ (v / total_portfolio * 100) | brl_fmt }}%</td>
                    </tr>
                    {% endfor %}
                    <tr class="bg-secondary font-weight-bold">
                        <td>TOTAL</td>
                        <td>R$ {{ total_portfolio | brl_fmt }}</td>
                        <td>100%</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Class Chart -->
        <div class="d-flex justify-content-center mt-3">
            <div style="max-width: 500px; width: 100%;">
                <canvas id="classChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Maturity Summary (Detailed per Type) -->
    <div class="col-12 mt-3">
        <h5 class="text-white mb-2">Por Prazo (Detalhado Renda Fixa)</h5>
        <div class="table-responsive">
            <table class="table table-dark table-bordered table-sm no-datatable table-center-forced">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Prazo</th>
                        <th>Valor</th>
                        <th>Percentual</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category, terms in maturity_breakdown.items() %}
                    {% for term, val in terms.items() %}
                    <tr>
                        {% if loop.first %}
                        <td rowspan="{{ loop.length }}" class="align-middle font-weight-bold">{{ category }}</td>
                        {% endif %}
                        <td>{{ term }}</td>
                        <td>R$ {{ val | brl_fmt }}</td>
                        <td>{{ (val / types_total[category] * 100) | brl_fmt }}%</td>
                    </tr>
                    {% endfor %}
                    <!-- Subtotal Row -->
                    <tr class="bg-secondary" style="font-weight: bold;">
                        <td colspan="2">TOTAL {{ category | upper }}</td>
                        <td>R$ {{ types_total[category] | brl_fmt }}</td>
                        <td>100,00%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Type Summary with Chart -->
    <div class="col-12 mt-3 mb-5">
        <h5 class="text-white mb-2">Por Tipo</h5>
        <div class="table-responsive">
            <table class="table table-dark table-bordered table-sm no-datatable table-center-forced">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Valor</th>
                        <th>Percentual</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Renda Fixa</td>
                        <td>R$ {{ summary['Renda Fixa'] | brl_fmt }}</td>
                        <td>{{ (summary['Renda Fixa']/total_portfolio * 100) | brl_fmt if total_portfolio > 0
                            else 0 }}%</td>
                    </tr>
                    <tr>
                        <td>Renda Vari√°vel</td>
                        <td>R$ {{ summary['Renda Vari√°vel'] | brl_fmt }}</td>
                        <td>{{ (summary['Renda Vari√°vel']/total_portfolio * 100) | brl_fmt if total_portfolio >
                            0 else 0 }}%</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- Type Chart (Below Table) -->
        <div class="d-flex justify-content-center mt-3">
            <div style="max-width: 500px; width: 100%;">
                <canvas id="typeChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Register DataLabels
        Chart.register(ChartDataLabels);

        // ... (commonOptions definition logic remains same, just ensuring script tag is there) ...
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'right', labels: { color: 'white', font: { size: 12 } } },

                // DATA LABELS CONFIGURATION
                datalabels: {
                    color: '#fff',
                    font: { weight: 'bold', size: 14 },
                    formatter: function (value, ctx) {
                        var sum = 0;
                        var dataArr = ctx.chart.data.datasets[0].data;
                        dataArr.map(function (data) {
                            sum += data;
                        });
                        var percentage = (value * 100 / sum).toFixed(1) + "%";
                        return percentage;
                    },
                    anchor: 'center', // Put it inside
                    align: 'center'
                }
            },
            layout: { padding: 20 }
        };

        // --- TYPE CHART ---
        const ctxType = document.getElementById('typeChart').getContext('2d');
        new Chart(ctxType, {
            type: 'pie',
            data: {
                labels: ['Renda Fixa', 'Renda Vari√°vel'],
                datasets: [{
                    data: [{{ summary['Renda Fixa'] }}, {{ summary['Renda Vari√°vel'] }}],
            backgroundColor: ['#3b82f6', '#10b981'],
            borderWidth: 1,
            borderColor: '#1e293b'
        }]
            },
        options: commonOptions
        });

    // --- CLASS CHART ---
    const ctxClass = document.getElementById('classChart').getContext('2d');

    // Prepare data from Jinja loop
    const classLabels = [];
    const classData = [];
    {% for k, v in types_total.items() %}
    {% if v > 0 %}
    classLabels.push('{{ k }}');
    classData.push({{ v }});
    {% endif %}
    {% endfor %}

    // Colors for classes
    const classColors = [
        '#ef4444', '#f97316', '#f59e0b', '#84cc16', '#10b981',
        '#06b6d4', '#3b82f6', '#6366f1', '#8b5cf6', '#d946ef', '#f43f5e'
    ];

    new Chart(ctxClass, {
        type: 'pie',
        data: {
            labels: classLabels,
            datasets: [{
                data: classData,
                backgroundColor: classColors,
                borderWidth: 1,
                borderColor: '#1e293b'
            }]
        },
        options: commonOptions
    });
    });
</script>

<!-- MODALS -->
<!-- Modal RF P√≥s -->
<div class="modal fade" id="modalRFC" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_rf') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Fixa P√≥s</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="POS">
                    <div class="mb-3">
                        <label>Tipo</label>
                        <select name="product_type" class="form-control mb-2">
                            <option value="CDB">CDB</option>
                            <option value="LCI">LCI</option>
                            <option value="LCA">LCA</option>
                            <option value="CRI">CRI</option>
                            <option value="CRA">CRA</option>
                            <option value="Tesouro">Tesouro</option>
                            <option value="RDB">RDB</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Banco</label><input type="text" name="institution" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Fundo/Descri√ß√£o</label><input type="text" name="name" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Taxa (ex: 120% CDI)</label><input type="text" name="rate"
                            class="form-control"></div>
                    <div class="mb-3"><label>Vencimento</label><input type="date" name="maturity_date"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-primary">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal RF Pr√© -->
<div class="modal fade" id="modalRFP" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_rf') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Fixa Pr√©</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="PRE">
                    <div class="mb-3">
                        <label>Tipo</label>
                        <select name="product_type" class="form-control mb-2">
                            <option value="CDB">CDB</option>
                            <option value="LCI">LCI</option>
                            <option value="LCA">LCA</option>
                            <option value="CRI">CRI</option>
                            <option value="CRA">CRA</option>
                            <option value="Tesouro">Tesouro</option>
                            <option value="RDB">RDB</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Banco</label><input type="text" name="institution" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Descri√ß√£o</label><input type="text" name="name" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Taxa (ex: 12% a.a.)</label><input type="text" name="rate"
                            class="form-control"></div>
                    <div class="mb-3"><label>Vencimento</label><input type="date" name="maturity_date"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-warning">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal RF IPCA -->
<div class="modal fade" id="modalRFI" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_rf') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Renda Fixa IPCA</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="IPCA">
                    <div class="mb-3">
                        <label>Tipo</label>
                        <select name="product_type" class="form-control mb-2">
                            <option value="CDB">CDB</option>
                            <option value="LCI">LCI</option>
                            <option value="LCA">LCA</option>
                            <option value="CRI">CRI</option>
                            <option value="CRA">CRA</option>
                            <option value="Tesouro">Tesouro</option>
                            <option value="RDB">RDB</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Banco</label><input type="text" name="institution" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Descri√ß√£o</label><input type="text" name="name" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Taxa (ex: IPCA+6%)</label><input type="text" name="rate"
                            class="form-control"></div>
                    <div class="mb-3"><label>Vencimento</label><input type="date" name="maturity_date"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-danger">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Fundos -->
<div class="modal fade" id="modalFund" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_fund') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Fundo</h5><button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="category" value="IPCA">
                    <div class="mb-3">
                        <label>Tipo</label>
                        <select name="product_type" class="form-control mb-2">
                            <option value="CDB">CDB</option>
                            <option value="LCI">LCI</option>
                            <option value="LCA">LCA</option>
                            <option value="CRI">CRI</option>
                            <option value="CRA">CRA</option>
                            <option value="Tesouro">Tesouro</option>
                            <option value="RDB">RDB</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Banco</label><input type="text" name="institution" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Fundo</label><input type="text" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Indexador</label><input type="text" name="indexer" class="form-control">
                    </div>
                    <div class="mb-3"><label>Vencimento (Opcional)</label><input type="date" name="maturity_date"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-info">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Crypto -->
<div class="modal fade" id="modalCrypto" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_crypto') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Cripto</h5><button type="button" class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3"><label>Exchange</label><input type="text" name="institution" class="form-control">
                    </div>
                    <div class="mb-3"><label>Nome (ex: BTC)</label><input type="text" name="name" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Quantidade</label><input type="text" name="quantity" class="form-control">
                    </div>
                    <div class="mb-3"><label>Valor Investido (R$)</label><input type="text" name="invested_value"
                            class="form-control"></div>
                    <div class="mb-3"><label>Valor Atual (R$)</label><input type="text" name="current_value"
                            class="form-control" required></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-dark">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

<!-- Modal Pension -->
<div class="modal fade" id="modalPension" tabindex="-1">
    <div class="modal-dialog">
        <form action="{{ url_for('add_pension') }}" method="POST">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Previd√™ncia</h5><button type="button"
                        class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3"><label>Institui√ß√£o</label><input type="text" name="institution"
                            class="form-control" required></div>
                    <div class="mb-3"><label>Plano</label><input type="text" name="name" class="form-control" required>
                    </div>
                    <div class="mb-3"><label>Valor (R$)</label><input type="text" name="value" class="form-control"
                            required></div>
                    <div class="mb-3"><label>Tipo</label>
                        <select name="type" class="form-control">
                            <option value="Renda Fixa">Renda Fixa</option>
                            <option value="Acao">A√ß√£o</option>
                        </select>
                    </div>
                    <div class="mb-3"><label>Certificado (Opcional)</label><input type="text" name="certificate"
                            class="form-control"></div>
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-success">Salvar</button></div>
            </div>
        </form>
    </div>
</div>

</form>
</div>
</div>
{% endblock %}